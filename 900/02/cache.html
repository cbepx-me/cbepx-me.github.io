<html manifest="cache.manifest">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>PS4IDEA 缓存安装</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #0b0e14 url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MCIgaGVpZ2h0PSI4MCIgdmlld0JveD0iMCAwIDgwIDgwIj48cGF0aCBkPSJNMjAgMjBoMTB2MTBIMjB6TTUwIDUwaDEwdjEwSDUweiIgZmlsbD0icmdiYSgyNTUsMjU1LDI1NSwwLjAyKSIvPjwvc3ZnPg==');
            background-size: 80px 80px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
            color: #e0e0e0;
        }

        .card {
            max-width: 700px;
            width: 100%;
            background: rgba(30, 30, 40, 0.75);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 32px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255,255,255,0.05);
            padding: 32px 32px 24px;
        }

        h2 {
            font-weight: 500;
            font-size: 2rem;
            margin-bottom: 16px;
            background: linear-gradient(135deg, #9bb7ff, #c7a4ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .info {
            color: #a0a8c0;
            margin-bottom: 24px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 16px;
        }

        .button-wrapper {
            text-align: center;
            margin: 20px 0;
        }

        #dummyBtn {
            background: #3a3f4b;
            border: none;
            border-radius: 60px;
            padding: 16px 48px;
            font-size: 1.3rem;
            font-weight: 600;
            color: #888f9e;
            cursor: not-allowed;
            box-shadow: none;
            width: 100%;
            max-width: 300px;
        }

        #console {
            background: #0c0f16;
            border-radius: 20px;
            padding: 20px;
            font-family: 'SF Mono', 'Fira Code', monospace;
            font-size: 14px;
            line-height: 1.6;
            color: #b4c2e0;
            border: 1px solid #2b3040;
            box-shadow: inset 0 4px 10px rgba(0, 0, 0, 0.6);
            white-space: pre-wrap;
            word-break: break-word;
            max-height: 300px;
            overflow-y: auto;
        }

        .footer {
            margin-top: 24px;
            text-align: right;
            font-size: 0.9rem;
            color: #7a82a0;
            border-top: 1px solid rgba(255,255,255,0.05);
            padding-top: 16px;
        }
    </style>
</head>
<body>
    <div class="card">
        <h2>☯ 缓存安装</h2>
        <div class="info">正在下载必要资源，请稍候… 完成后将自动跳转。</div>

        <div class="button-wrapper">
            <button id="dummyBtn" disabled>准备中</button>
        </div>

        <pre id="console"></pre>

        <div class="footer">
            PS4IDEA · 首次运行需缓存
        </div>
    </div>
  </body>
  <script>
    // Clear history and prevent back navigation
    history.replaceState(null, null, 'index.html');
    var histlength = history.length;
    history.go(-histlength);
    // Logging utility
    const outputConsole = document.getElementById("console");
    window.log = (msg) => { outputConsole.textContent += msg + "\n"; };
    // Download progress (% display)
    function DLProgress(e) {
      const percent = (Math.round((e.loaded / e.total) * 100));
      window.log(`[缓存] 正在下载... ${percent}% complete.`);
    }
    // On cache complete
    function DisplayCacheProgress() {
      window.log(" ");
      window.log("[成功] 缓存安装成功.");
      window.log("页面将在3秒后自动刷新...");
      // Delay to show success message before navigation
      setTimeout(function() { window.log("正在重新加载..."); }, 2000);
      // Navigate back to index.html to load the exploit from cache
      setTimeout(function() { location.reload(); }, 3000);
    }
    // Event listeners
    window.applicationCache.addEventListener("progress", DLProgress, false);
    window.applicationCache.oncached = function(e) { DisplayCacheProgress(); };
    window.applicationCache.onupdateready = function(e) { DisplayCacheProgress(); };
    // Initialization message on DOM load
    document.addEventListener('DOMContentLoaded', () => {
      outputConsole.textContent = ""; // Clear console log
      window.log("AppCache 下载启动中...");
      window.log("请稍候，这可能需要几秒钟.");
    });
  </script>
</html>
